@model EmPeka.Frontend.Models.ArrivalsResponse
@{
    ViewData["Title"] = $"{Model.StopName} ({Model.StopCode})";
}


<div class="fullscreen">
    <div class="header">
        <div class="timestamp">@DateTime.Now</div>
        <div class="stop-name">@Model.StopName.ToUpper() (@Model.StopCode)</div>
    </div>

    <div class="arrivals">
        @if (Model?.Arrivals == null || Model.Arrivals.Count == 0)
        {
            <div class="empty">Brak nadchodzących odjazdów.</div>
        }
        else
        {
            <div class="arrival-row" style="font-weight:bold; text-transform:uppercase; color: white; background: black; font-family: Segoe UI, Roboto, Arial, sans-serif">
                <div class="line">LINIA</div>
                <div class="direction">KIERUNEK</div>
                <div class="eta">PLANOWO</div>
                <div class="eta">ODJAZD</div>
            </div>
            foreach (var a in Model.Arrivals)
            {
                <div class="arrival-row @(a.IsRealTime ? "rt" : "tt")">
                    <div class="line">@a.Line</div>
                    <div class="direction">@a.Direction</div>
                    <div class="eta">
                        @a.ScheduledDeparture.Substring(0, 5)
                    </div>
                    <div class="eta">
                        @a.EtaMin min
                    </div>
                </div>
            }
        }
    </div>
</div>

<style>
    :root {
        color-scheme: dark;
    }

    html, body {
        height: 100%;
    }

    body {
        margin: 0;
        color: #ff8c00;
    }

    .container {
        max-width: 100% !important;
        padding: 0 !important;
    }

    .fullscreen {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background: #0a0a0a;
        border-style: solid;
        border-color: black;
        border-width: 50px 50px;
        box-sizing: border-box;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 1.5rem;
    }

    .stop-name {
        font-size: 2.5rem;
    }

    .timestamp {
        font-size: 3rem;
        font-weight: 700
    }

    .arrivals {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .arrival-row {
        display: grid;
        grid-template-columns: 120px 1fr 200px 200px;
        align-items: center;
        padding: 1rem;
    }
    /*     .arrival-row.rt { box-shadow: 0 0 12px rgba(255, 140, 0, 0.35); }
     */ .line {
        font-size: 2rem
    }

    .direction {
        font-size: 2rem;
    }

    .eta {
        font-size: 2rem;
        text-align: right;
    }

    .empty {
        font-size: 2rem;
        opacity: 0.8;
    }

    @@media (max-width: 768px) {
        .arrival-row {
            grid-template-columns: 90px 1fr 120px;
        }

        .stop-name {
            font-size: 2rem;
        }

        .direction {
            font-size: 1.4rem;
        }

        .eta, .line {
            font-size: 1.6rem;
        }
    }
</style>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const stopCode = urlParams.get('stopCode') || '10606';
    const count = urlParams.get('count');

    async function updateArrivals() {
        try {
            let url = `/api/arrivals/${stopCode}`;
            if (count) {
                url += `?count=${count}`;
            }

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            const timestampEl = document.querySelector('.timestamp');
            if (timestampEl) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('pl-PL', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                const timeStr = now.toLocaleTimeString('pl-PL', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                timestampEl.textContent = `${dateStr} ${timeStr}`;
            }

            const stopNameEl = document.querySelector('.stop-name');
            if (stopNameEl) {
                stopNameEl.textContent = `${data.stopName.toUpperCase()} (${data.stopCode})`;
            }

            const arrivalsContainer = document.querySelector('.arrivals');
            if (arrivalsContainer && data.arrivals && data.arrivals.length > 0) {
                let newContent = `
                    <div class="arrival-row" style="font-weight:bold; text-transform:uppercase; color: white; background: black; font-family: Segoe UI, Roboto, Arial, sans-serif">
                        <div class="line">LINIA</div>
                        <div class="direction">KIERUNEK</div>
                        <div class="eta">PLANOWO</div>
                        <div class="eta">ODJAZD</div>
                    </div>`;
                
                data.arrivals.forEach(arrival => {
                    newContent += `
                        <div class="arrival-row ${arrival.isRealTime ? 'rt' : 'tt'}">
                            <div class="line">${arrival.line}</div>
                            <div class="direction">${arrival.direction}</div>
                            <div class="eta">${arrival.scheduledDeparture ? arrival.scheduledDeparture.substring(0, 5) : ''}</div>
                            <div class="eta">${arrival.etaMin} min</div>
                        </div>`;
                });
                
                arrivalsContainer.innerHTML = newContent;
            } else if (arrivalsContainer) {
                arrivalsContainer.innerHTML = '<div class="empty">Brak nadchodzących odjazdów.</div>';
            }

        } catch (error) {
            console.error('Błąd podczas pobierania danych:', error);
        }
    }

    setInterval(updateArrivals, 30000);

    document.addEventListener('DOMContentLoaded', function() {
        const timestampEl = document.querySelector('.timestamp');
        if (timestampEl) {
            timestampEl.style.cursor = 'pointer';
            timestampEl.title = 'Kliknij aby odświeżyć dane';
            timestampEl.addEventListener('click', updateArrivals);
        }
    });
</script>
