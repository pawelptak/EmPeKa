@model EmPeKa.Frontend.Models.ArrivalsResponse
@inject IConfiguration Configuration
@{
    ViewData["Title"] = $"{Model.StopName} ({Model.StopCode})";
    var basePath = Configuration.GetValue<string>("BasePath") ?? string.Empty;
}


<div class="fullscreen">
    <div class="header">
        <div class="timestamp">@DateTime.Now.ToString("dd.MM.yyyy HH:mm:ss")</div>
        <div class="stop-name">@Model.StopName.ToUpper() (@Model.StopCode)</div>
    </div>

    <div class="arrivals">
        @if (Model?.Arrivals == null || Model.Arrivals.Count == 0)
        {
            <div class="empty">Brak nadchodzących odjazdów.</div>
        }
        else
        {
            <div class="arrival-row" style="font-weight:bold; text-transform:uppercase; color: white; background: black; font-family: Segoe UI, Roboto, Arial, sans-serif">
                <div class="line">LINIA</div>
                <div class="direction">KIERUNEK</div>
                <div class="eta">PLANOWO</div>
                <div class="eta">ODJAZD</div>
            </div>
            foreach (var a in Model.Arrivals)
            {
                <div class="arrival-row @(a.IsRealTime ? "rt" : "tt")">
                    <div class="line">@a.Line</div>
                    <div class="direction">@a.Direction</div>
                    <div class="eta">
                        @a.ScheduledDeparture.Substring(0, 5)
                    </div>
                    <div class="eta">
                        @a.EtaMin min
                    </div>
                </div>
            }
        }
    </div>
</div>

<style>
    :root {
        color-scheme: dark;
    }

    html, body {
        height: 100%;
    }

    body {
        margin: 0;
        color: #ff8c00;
    }

    .container {
        max-width: 100% !important;
        padding: 0 !important;
    }

    .fullscreen {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background: #0a0a0a;
        border-style: solid;
        border-color: black;
        border-width: 50px 50px;
        box-sizing: border-box;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 1.5rem;
    }

    .stop-name {
        font-size: 2.5rem;
    }

    .timestamp {
        font-size: 3rem;
        font-weight: 700
    }

    .arrivals {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .arrival-row {
        display: grid;
        grid-template-columns: 120px 1fr 200px 200px;
        align-items: center;
        padding: 1rem;
    }

        .arrival-row:first-child {
            position: sticky;
            top: 0;
            z-index: 10;
        }

    .line {
        font-size: 2rem
    }

    .direction {
        font-size: 2rem;
    }

    .eta {
        font-size: 2rem;
        text-align: right;
    }

    .empty {
        font-size: 2rem;
        opacity: 0.8;
    }

    @@media (max-width: 768px) {
        .fullscreen {
            border-width: 20px;
        }

        .arrival-row {
            grid-template-columns: 70px 1fr 80px 80px;
            gap: 0.5rem;
            padding: 0.75rem 0.5rem;
        }

            .arrival-row:first-child .line,
            .arrival-row:first-child .direction,
            .arrival-row:first-child .eta {
                font-size: 1.1rem;
            }

        .header {
            margin-bottom: 1rem;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .stop-name {
            font-size: 1.8rem;
        }

        .timestamp {
            font-size: 2rem;
        }

        .direction {
            font-size: 1.2rem;
        }

        .eta, .line {
            font-size: 1.4rem;
        }
    }

    @@media (max-width: 576px) {
        .fullscreen {
            border-width: 15px;
        }

        .arrival-row {
            grid-template-columns: 55px 1fr 65px 65px;
            gap: 0.25rem;
            padding: 0.5rem 0.25rem;
        }

            .arrival-row:first-child .line,
            .arrival-row:first-child .direction,
            .arrival-row:first-child .eta {
                font-size: 0.9rem;
            }

        .stop-name {
            font-size: 1.5rem;
        }

        .timestamp {
            font-size: 1.6rem;
        }

        .direction {
            font-size: 1rem;
            line-height: 1.2;
        }

        .eta, .line {
            font-size: 1.2rem;
        }

        .empty {
            font-size: 1.5rem;
        }
    }

    @@media (max-width: 480px) {
        .fullscreen {
            border-width: 10px;
        }

        .arrival-row {
            grid-template-columns: 50px 1fr 55px 55px;
            gap: 0.2rem;
            padding: 0.4rem 0.2rem;
        }

            .arrival-row:first-child .line,
            .arrival-row:first-child .direction,
            .arrival-row:first-child .eta {
                font-size: 0.8rem;
            }

        .header {
            gap: 0.25rem;
        }

        .stop-name {
            font-size: 1.25rem;
        }

        .timestamp {
            font-size: 1.4rem;
        }

        .direction {
            font-size: 0.9rem;
        }

        .eta, .line {
            font-size: 1rem;
        }

        .empty {
            font-size: 1.25rem;
        }
    }

    @@media (max-width: 360px) {
        .arrival-row {
            grid-template-columns: 45px 1fr 50px 50px;
            padding: 0.3rem 0.15rem;
        }

            .arrival-row:first-child .line,
            .arrival-row:first-child .direction,
            .arrival-row:first-child .eta {
                font-size: 0.7rem;
            }

        .stop-name {
            font-size: 1.1rem;
        }

        .timestamp {
            font-size: 1.2rem;
        }

        .direction {
            font-size: 0.8rem;
        }

        .eta, .line {
            font-size: 0.9rem;
        }
    }
</style>

<script src="~/js/refreshArrivals.js"></script>
<script>
const basePath = @Json.Serialize(basePath);
const urlParams = new URLSearchParams(window.location.search);
const stopCode = urlParams.get('stopCode') || '10606';
const count = urlParams.get('count');

refreshArrivals({
    basePath,
    arrivalsSelector: '.arrivals',
    timestampSelector: '.timestamp',
    stopNameSelector: '.stop-name',
    apiType: 'single',
    stopCodes: [stopCode],
    count
});
</script>
